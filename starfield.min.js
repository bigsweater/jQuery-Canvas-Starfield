!function($,window,document){var Starfield=function(el,options){this.el=el,this.$el=$(el),this.options=options,obj=this};Starfield.prototype={defaults:{starColor:"rgba(255,255,255,1)",bgColor:"rgba(0,0,0,1)",mouseMove:!0,mouseColor:"rgba(0,0,0,0.2)",mouseSpeed:20,fps:15,speed:5,quantity:512,ratio:256,"class":"starfield"},resizer:function(){this.w=$(this.el).width(),this.h=$(this.el).height(),this.x=Math.round(this.w/2),this.y=Math.round(this.h/2),this.z=(this.w+this.h)/2,this.star_color_ratio=1/this.z,this.cursor_x=this.x,this.cursor_y=this.y,$(window).resize(function(){$("canvas",obj.el).remove(),obj.init()}),this.init()},init:function(){this.canvas(),this.starz=$("canvas",this.el),this.starz.width=this.w,this.starz.height=this.h,this.context=this.starz[0].getContext("2d");for(var i=0;i<this.n;i++)this.star[i]=new Array(5),this.star[i][0]=2*Math.random()*this.w-2*this.x,this.star[i][1]=2*Math.random()*this.h-2*this.y,this.star[i][2]=Math.round(Math.random()*this.z),this.star[i][3]=0,this.star[i][4]=0;this.context.fillStyle=this.settings.bgColor,this.context.strokeStyle=this.settings.starColor},canvas:function(){this.w=$(this.el).width(),this.h=$(this.el).height(),this.wrapper=$("<canvas />").attr({width:this.w,height:this.h}).addClass(this.settings.class),this.wrapper.appendTo(this.el)},anim:function(){this.mouse_x=this.cursor_x-this.x,this.mouse_y=this.cursor_y-this.y,this.context.fillRect(0,0,this.w,this.h);for(var i=0;i<this.n;i++)this.test=!0,this.star_x_save=this.star[i][3],this.star_y_save=this.star[i][4],this.star[i][0]+=this.mouse_x>>4,this.star[i][0]>this.x<<1&&(this.star[i][0]-=this.w<<1,this.test=!1),this.star[i][0]<-this.x<<1&&(this.star[i][0]+=this.w<<1,this.test=!1),this.star[i][1]+=this.mouse_y>>4,this.star[i][1]>this.y<<1&&(this.star[i][1]-=this.h<<1,this.test=!1),this.star[i][1]<-this.y<<1&&(this.star[i][1]+=this.h<<1,this.test=!1),this.star[i][2]-=this.star_speed,this.star[i][2]>this.z&&(this.star[i][2]-=this.z,this.test=!1),this.star[i][2]<0&&(this.star[i][2]+=this.z,this.test=!1),this.star[i][3]=this.x+this.star[i][0]/this.star[i][2]*this.star_ratio,this.star[i][4]=this.y+this.star[i][1]/this.star[i][2]*this.star_ratio,this.star_x_save>0&&this.star_x_save<this.w&&this.star_y_save>0&&this.star_y_save<this.h&&this.test&&(this.context.lineWidth=2*(1-this.star_color_ratio*this.star[i][2]),this.context.beginPath(),this.context.moveTo(this.star_x_save,this.star_y_save),this.context.lineTo(this.star[i][3],this.star[i][4]),this.context.stroke(),this.context.closePath())},loop:function(){this.anim(),window.requestAnimationFrame(this.loop.bind(this)),$(window).resize(function(){}),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,fps-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}()},move:window.onmousemove=function(evt){evt=evt||event;var doc=document.documentElement;obj.cursor_x=evt.pageX||evt.clientX+doc.scrollLeft-doc.clientLeft,obj.cursor_y=evt.pageY||evt.clientY+doc.scrollTop-doc.clientTop},start:function(){this.settings=$.extend({},this.defaults,this.options,this.metadata);var url=document.location.href;return this.n=parseInt(-1!=url.indexOf("n=")?url.substring(url.indexOf("n=")+2,-1!=url.substring(url.indexOf("n=")+2,url.length).indexOf("&")?url.indexOf("n=")+2+url.substring(url.indexOf("n=")+2,url.length).indexOf("&"):url.length):this.settings.quantity),this.flag=!0,this.test=!0,this.w=0,this.h=0,this.x=0,this.y=0,this.z=0,this.star_color_ratio=0,this.star_x_save=0,this.star_y_save,this.star_ratio=this.settings.ratio,this.star_speed=this.settings.speed,this.star_speed_save=0,this.star=new Array(this.n),this.color,this.opacity=.1,this.cursor_x=0,this.cursor_y=0,this.mouse_x=0,this.mouse_y=0,this.canvas_x=0,this.canvas_y=0,this.canvas_w=0,this.canvas_h=0,this.fps=this.settings.fps,this.resizer(),this.loop(),this}},Starfield.defaults=Starfield.prototype.defaults,$.fn.starfield=function(options){return this.each(function(){new Starfield(this,options).start()})}}(jQuery,window,document);